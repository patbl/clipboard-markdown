#!/usr/bin/env python3
import os
import subprocess
import sys
from AppKit import NSPasteboard

# Read markdown from stdin
markdown = sys.stdin.read()

if not markdown:
    sys.exit(0)

# Use pandoc from $resourcePath, if set, for Platypus bundle compatibility.
pandoc_cmd = 'pandoc'
resource_path = os.environ.get('resourcePath')
if resource_path:
    bundled_pandoc = os.path.join(resource_path, 'pandoc')
    if os.path.exists(bundled_pandoc):
        pandoc_cmd = bundled_pandoc

# Convert markdown to HTML using pandoc
result = subprocess.run(
    [pandoc_cmd, '-f', 'gfm', '-t', 'html'],
    input=markdown,
    capture_output=True,
    text=True
)

html = result.stdout

# Put HTML on clipboard using NSPasteboard
pasteboard = NSPasteboard.generalPasteboard()
pasteboard.clearContents()
pasteboard.setString_forType_(html, "public.html")
