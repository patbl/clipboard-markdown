#!/bin/bash
# Set HTML content to the macOS clipboard using AppleScript
# Reads HTML from stdin

# Read stdin into a temp file (handles large content and special characters safely)
TMPFILE=$(mktemp)
trap "rm -f '$TMPFILE'" EXIT
cat > "$TMPFILE"

osascript -l JavaScript -e '
ObjC.import("AppKit");
ObjC.import("Foundation");

function run(argv) {
    const path = argv[0];
    const content = $.NSString.stringWithContentsOfFileEncodingError(path, $.NSUTF8StringEncoding, null);

    if (content && !content.isNil()) {
        const pb = $.NSPasteboard.generalPasteboard;
        pb.clearContents;
        pb.setStringForType(content, $.NSPasteboardTypeHTML);
        pb.setStringForType(content, $.NSPasteboardTypeString);
    }
}
' -- "$TMPFILE"
